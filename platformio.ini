[platformio]
default_envs = esp32-4832S040R

; Keep the custom board directory relative to the project root; interpolating
; ${project_dir} from the [platformio] section does not work and causes PlatformIO
; to ignore the folder, which makes the custom boards invisible.
boards_dir = boards

[common]
platform = espressif32@6.10.0
framework = arduino
extra_scripts =
    pre:scripts/pio_prepend_project_include.py
monitor_speed = 115200
monitor_rts = 0
monitor_dtr = 0
;sue on github board_build.sdkconfig = sdkconfig.esp32-2432S028Rv2
;board_build.sdkconfig = sdkconfig.esp32-2432S028Rv2-uart0
board_build.sdkconfig = sdkconfig.esp32-4832S035C

build_flags = 
    -Os
    -D CORE_DEBUG_LEVEL=ARDUHAL_LOG_LEVEL_NONE
    -D LV_CONF_PATH=\"lv_conf.h\"
    -D LV_CONF_INCLUDE_SIMPLE=1
    -D LV_MEM_SIZE=24576
    -D LV_CONF_SUPPRESS_DEFINE_CHECK=1
    -I ${PROJECT_DIR}/include
    -D LV_FONT_MONTSERRAT_20=1
    -D LV_FONT_MONTSERRAT_32=1
    -D LV_USE_SNAPSHOT=1
    -D ILI9341_SPI_CONFIG_FLAGS_DC_AS_CMD_PHASE=0
    -D XPT2046_SPI_CONFIG_FLAGS_DC_AS_CMD_PHASE=0
    -D REMOTE_DISPLAY_ENABLED=0
    -D WIFI_ENABLED=0
    -D BLE_ENABLED=1
    -D ESP_NOW_ENABLED=0
    -D SMARTDISPLAY_BUFF_LINES=8
    -D CONFIG_ASYNC_TCP_QUEUE_SIZE=8
    -D CONFIG_ASYNC_TCP_RUNNING_CORE=1
    -D CONFIG_ASYNC_TCP_MAX_ACK_TIME=3000
    -Wl,--wrap=gpio_set_level
    # M5Stack 8Encoder support (disabled by default)
    # Uncomment the next line to enable M5Stack 8Encoder expansion unit
    # -D ENABLE_M5_8ENCODER=1
    # Baby8 software emulation (disabled by default)
    # Uncomment the next line to enable Baby8 8-step sequencer emulation
    -D ENABLE_BABY8_EMU=1

lib_deps =
    https://github.com/julesdg6/esp32-smartdisplay.git#develop
    https://github.com/grantler-instruments/ESP-NOW-MIDI.git
    https://github.com/julesdg6/uClock.git

[env:esp32-2432S028R]
extends = common
board = esp32-2432S028R
build_flags = 
    ${common.build_flags}
    -D BOARD_NAME=\"esp32-2432S028R\"

[env:esp32-2432S028Rv2]
extends = common
board = esp32-2432S028Rv2
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    # Default: UART2 (GPIO16/17) with debug enabled
    # Uncomment next line for UART0 (GPIO1/3) without debug:
    # -D HARDWARE_MIDI_UART=0
    -D BOARD_NAME=\"esp32-2432S028Rv2\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
upload_speed = 115200
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# Development build with UART2 (GPIO16/17) - Debug enabled
[env:esp32-2432S028Rv2-uart2]
extends = common
board = esp32-2432S028Rv2
board_build.partitions = huge_app.csv

build_flags = 
    ${common.build_flags}
    -D HARDWARE_MIDI_UART=2
    -D BOARD_NAME=\"esp32-2432S028Rv2\"

lib_deps = ${common.lib_deps}

# Production build with UART0 (GPIO1/3) - Debug disabled
[env:esp32-2432S028Rv2-uart0]
extends = common
board = esp32-2432S028Rv2
board_build.partitions = huge_app.csv

build_flags = 
    ${common.build_flags}
    -D HARDWARE_MIDI_UART=0
    -D BOARD_NAME=\"esp32-2432S028Rv2\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti

lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# ESP32-4832S035C - 3.5" 480x320 capacitive touch
[env:esp32-4832S035C]
extends = common
board = esp32-4832S035C
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D BOARD_NAME=\"esp32-4832S035C\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
upload_speed = 115200
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# ESP32-4832S035C with UART2 (GPIO16/17) - Debug enabled
[env:esp32-4832S035C-uart2]
extends = common
board = esp32-4832S035C
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D HARDWARE_MIDI_UART=2
    -D BOARD_NAME=\"esp32-4832S035C\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
upload_speed = 115200
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# ESP32-4832S035C with UART0 (GPIO1/3) - Debug disabled
[env:esp32-4832S035C-uart0]
extends = common
board = esp32-4832S035C
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D HARDWARE_MIDI_UART=0
    -D BOARD_NAME=\"esp32-4832S035C\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# ESP32-4832S035R - 3.5" 480x320 resistive touch
[env:esp32-4832S035R]
extends = common
board = esp32-4832S035R
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D BOARD_NAME=\"esp32-4832S035R\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
upload_speed = 115200
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# ESP32-4832S035R with UART2 (GPIO16/17) - Debug enabled
[env:esp32-4832S035R-uart2]
extends = common
board = esp32-4832S035R
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D HARDWARE_MIDI_UART=2
    -D BOARD_NAME=\"esp32-4832S035R\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
upload_speed = 115200
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# ESP32-4832S035R with UART0 (GPIO1/3) - Debug disabled
[env:esp32-4832S035R-uart0]
extends = common
board = esp32-4832S035R
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D HARDWARE_MIDI_UART=0
    -D BOARD_NAME=\"esp32-4832S035R\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# ESP32-4832S040R - 4.0" 320x480 resistive touch
[env:esp32-4832S040R]
extends = common
board = esp32-4832S040R
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D BOARD_NAME=\"esp32-4832S040R\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
upload_speed = 115200
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# ESP32-4832S040R with UART2 (GPIO16/17) - Debug enabled
[env:esp32-4832S040R-uart2]
extends = common
board = esp32-4832S040R
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D HARDWARE_MIDI_UART=2
    -D BOARD_NAME=\"esp32-4832S040R\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
upload_speed = 115200
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# ESP32-4832S040R with UART0 (GPIO1/3) - Debug disabled
[env:esp32-4832S040R-uart0]
extends = common
board = esp32-4832S040R
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D HARDWARE_MIDI_UART=0
    -D BOARD_NAME=\"esp32-4832S040R\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# Elecrow ESP32 7.0" - 800x480 capacitive touch
[env:elecrow-esp32-7_0]
extends = common
board = elecrow-esp32-7_0
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    # Elecrow 7" uses many GPIOs for the RGB panel (incl. GPIO16), so the
    # default hardware MIDI UART2 pin mapping (GPIO16/17) conflicts with the display.
    # Leave DIN-5 hardware MIDI disabled by default; BLE MIDI remains enabled.
    -D HARDWARE_MIDI_ENABLED=false
    -D BOARD_NAME=\"elecrow-esp32-7_0\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
upload_speed = 115200
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_size = 4MB
board_build.flash_mode = qio

# Elecrow ESP32 7.0" with UART2 (GPIO16/17) - Debug enabled
[env:elecrow-esp32-7_0-uart2]
extends = common
board = elecrow-esp32-7_0
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D HARDWARE_MIDI_UART=2
    -D HARDWARE_MIDI_ENABLED=false
    -D BOARD_NAME=\"elecrow-esp32-7_0\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
upload_speed = 115200
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_size = 4MB
board_build.flash_mode = qio

# Elecrow ESP32 7.0" with UART0 (GPIO1/3) - Debug disabled
[env:elecrow-esp32-7_0-uart0]
extends = common
board = elecrow-esp32-7_0
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D HARDWARE_MIDI_UART=0
    -D HARDWARE_MIDI_ENABLED=false
    -D BOARD_NAME=\"elecrow-esp32-7_0\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
upload_speed = 115200
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_size = 4MB
board_build.flash_mode = qio

# Headless ESP-NOW master (no display/UI, no USB MIDI - standard ESP32)
[env:esp32-headless-midi-master]
extends = common
board = esp32dev
board_build.partitions = huge_app.csv
build_flags =
    -Os
    -D HEADLESS_BUILD=1
    -D USB_MIDI_DEVICE=0
    -D ESP_NOW_ENABLED=1
    -D BLE_ENABLED=1
    -D LV_CONF_INCLUDE_SIMPLE=1
    -I ${PROJECT_DIR}/include
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags =
    -fno-rtti
lib_deps =
    https://github.com/grantler-instruments/ESP-NOW-MIDI.git
board_build.f_flash = 80000000L
board_build.flash_mode = qio
build_src_filter = +<main_headless.cpp>

# Headless ESP32-S3 USB MIDI dongle (no display/UI)
[env:esp32s3-headless]
extends = common
board = esp32-s3-devkitc-1
board_build.partitions = huge_app.csv
build_flags =
    -Os
    -D HEADLESS_BUILD=1
    -D USB_MIDI_DEVICE=1
    -D ESP_NOW_ENABLED=1
    -D BLE_ENABLED=1
    -D LV_CONF_INCLUDE_SIMPLE=1
    -D ARDUINO_USB_MODE=1
    -D ARDUINO_USB_CDC_ON_BOOT=0
    -I ${PROJECT_DIR}/include
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags =
    -fno-rtti
lib_deps =
    https://github.com/grantler-instruments/ESP-NOW-MIDI.git
    adafruit/Adafruit TinyUSB Library @ ^3.3.0
board_build.f_flash = 80000000L
board_build.flash_mode = qio
build_src_filter = +<main_headless.cpp>
