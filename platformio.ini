[platformio]
default_envs = esp32-2432S028Rv2
; Keep the custom board directory relative to the project root; interpolating
; ${project_dir} from the [platformio] section does not work and causes PlatformIO
; to ignore the folder, which makes the custom boards invisible.
boards_dir = boards

[common]
platform = espressif32@6.10.0
framework = arduino
monitor_speed = 115200
monitor_rts = 0
monitor_dtr = 0
;sue on github board_build.sdkconfig = sdkconfig.esp32-2432S028Rv2
;board_build.sdkconfig = sdkconfig.esp32-2432S028Rv2-uart0
board_build.sdkconfig = sdkconfig.esp32-3248S035C

build_flags = 
    -Os
    -D CORE_DEBUG_LEVEL=ARDUHAL_LOG_LEVEL_NONE
    -D LV_CONF_PATH=\"lv_conf.h\"
    -D LV_CONF_INCLUDE_SIMPLE=1
    -D LV_MEM_SIZE=24576
    -D LV_CONF_SUPPRESS_DEFINE_CHECK=1
    -I ${project_dir}/include
    -D LV_FONT_MONTSERRAT_20=1
    -D LV_FONT_MONTSERRAT_32=1
    -D LV_USE_SNAPSHOT=1
    -D ILI9341_SPI_CONFIG_FLAGS_DC_AS_CMD_PHASE=0
    -D XPT2046_SPI_CONFIG_FLAGS_DC_AS_CMD_PHASE=0
    -D REMOTE_DISPLAY_ENABLED=0
    -D WIFI_ENABLED=0
    -D BLE_ENABLED=1
    -D ESP_NOW_ENABLED=1
    -D SMARTDISPLAY_BUFF_LINES=8
    -D CONFIG_ASYNC_TCP_QUEUE_SIZE=8
    -D CONFIG_ASYNC_TCP_RUNNING_CORE=1
    -D CONFIG_ASYNC_TCP_MAX_ACK_TIME=3000

lib_deps =
    https://github.com/julesdg6/esp32-smartdisplay.git#develop
    https://github.com/grantler-instruments/ESP-NOW-MIDI.git

[env:esp32-2432S028R]
extends = common
board = esp32-2432S028R
build_flags = 
    ${common.build_flags}
    -D BOARD_NAME=\"esp32-2432S028R\"

[env:esp32-2432S028Rv2]
extends = common
board = esp32-2432S028Rv2
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    # Default: UART2 (GPIO16/17) with debug enabled
    # Uncomment next line for UART0 (GPIO1/3) without debug:
    # -D HARDWARE_MIDI_UART=0
    -D BOARD_NAME=\"esp32-2432S028Rv2\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
upload_speed = 115200
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# Development build with UART2 (GPIO16/17) - Debug enabled
[env:esp32-2432S028Rv2-uart2]
extends = common
board = esp32-2432S028Rv2
board_build.partitions = huge_app.csv

build_flags = 
    ${common.build_flags}
    -D HARDWARE_MIDI_UART=2
    -D BOARD_NAME=\"esp32-2432S028Rv2\"

lib_deps = ${common.lib_deps}

# Production build with UART0 (GPIO1/3) - Debug disabled
[env:esp32-2432S028Rv2-uart0]
extends = common
board = esp32-2432S028Rv2
board_build.partitions = huge_app.csv

build_flags = 
    ${common.build_flags}
    -D HARDWARE_MIDI_UART=0
    -D BOARD_NAME=\"esp32-2432S028Rv2\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti

lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# ESP32-3248S035C - 3.5" 480x320 capacitive touch
[env:esp32-3248S035C]
extends = common
board = esp32-3248S035C
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D BOARD_NAME=\"esp32-3248S035C\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
upload_speed = 115200
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# ESP32-3248S035C with UART2 (GPIO16/17) - Debug enabled
[env:esp32-3248S035C-uart2]
extends = common
board = esp32-3248S035C
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D HARDWARE_MIDI_UART=2
    -D BOARD_NAME=\"esp32-3248S035C\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
upload_speed = 115200
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# ESP32-3248S035C with UART0 (GPIO1/3) - Debug disabled
[env:esp32-3248S035C-uart0]
extends = common
board = esp32-3248S035C
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D HARDWARE_MIDI_UART=0
    -D BOARD_NAME=\"esp32-3248S035C\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# ESP32-3248S035R - 3.5" 480x320 resistive touch
[env:esp32-3248S035R]
extends = common
board = esp32-3248S035R
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D BOARD_NAME=\"esp32-3248S035R\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
upload_speed = 115200
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# ESP32-3248S035R with UART2 (GPIO16/17) - Debug enabled
[env:esp32-3248S035R-uart2]
extends = common
board = esp32-3248S035R
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D HARDWARE_MIDI_UART=2
    -D BOARD_NAME=\"esp32-3248S035R\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
upload_speed = 115200
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# ESP32-3248S035R with UART0 (GPIO1/3) - Debug disabled
[env:esp32-3248S035R-uart0]
extends = common
board = esp32-3248S035R
board_build.partitions = huge_app.csv
build_flags = 
    ${common.build_flags}
    -D DISABLE_TASK_WDT=1
    -D HARDWARE_MIDI_UART=0
    -D BOARD_NAME=\"esp32-3248S035R\"
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags = 
    -fno-rtti
lib_deps = ${common.lib_deps}
board_build.f_flash = 80000000L
board_build.flash_mode = qio

# Headless USB MIDI + ESP-NOW sync (no display/UI)
[env:esp32-headless-midi-master]
extends = common
board = esp32dev
board_build.partitions = huge_app.csv
build_flags =
    -Os
    -D HEADLESS_BUILD=1
    -D USB_MIDI_DEVICE=1
    -D ESP_NOW_ENABLED=1
    -D BLE_ENABLED=1
    -D LV_CONF_INCLUDE_SIMPLE=1
    -I ${project_dir}/include
    -Wl,--gc-sections
    -ffunction-sections
    -fdata-sections
build_unflags =
    -fno-rtti
lib_deps =
    https://github.com/grantler-instruments/ESP-NOW-MIDI.git
board_build.f_flash = 80000000L
board_build.flash_mode = qio
build_src_filter = +<main_headless.cpp>
