{"version":3,"file":"index-BiyG5hPg.js","sources":["../../src/eventBus.ts","../../src/types.ts","../../src/bleMidi.ts","../../src/serial.ts","../../src/logger.ts","../../src/controller.ts","../../src/synth303.ts","../../src/main.ts"],"sourcesContent":["import type { LogEntry } from './types';\n\n// ============================================================\n// EventBus - Central event system for all log entries\n// ============================================================\n\ntype EventCallback = (entry: LogEntry) => void;\n\nexport class EventBus {\n  private listeners: EventCallback[] = [];\n  private t0: number;\n\n  constructor() {\n    this.t0 = performance.now();\n  }\n\n  subscribe(callback: EventCallback): () => void {\n    this.listeners.push(callback);\n    return () => {\n      const index = this.listeners.indexOf(callback);\n      if (index > -1) {\n        this.listeners.splice(index, 1);\n      }\n    };\n  }\n\n  emit(entry: Omit<LogEntry, 'id' | 'tAbsMs' | 'tRelMs'>): void {\n    const fullEntry: LogEntry = {\n      id: this.generateId(),\n      tAbsMs: Date.now(),\n      tRelMs: performance.now() - this.t0,\n      ...entry,\n    };\n\n    this.listeners.forEach(callback => callback(fullEntry));\n  }\n\n  private generateId(): string {\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  reset(): void {\n    this.t0 = performance.now();\n  }\n}\n","// ============================================================\n// Data Models\n// ============================================================\n\nexport type LogSource =\n  | \"UI_TO_MIDI\"\n  | \"BLE_IN\"\n  | \"BLE_OUT\"\n  | \"SERIAL_IN\"\n  | \"SERIAL_OUT\";\n\nexport type MidiKind =\n  | \"NOTE_ON\"\n  | \"NOTE_OFF\"\n  | \"CC\"\n  | \"PC\"\n  | \"PB\"\n  | \"CLOCK\"\n  | \"START\"\n  | \"STOP\"\n  | \"CONTINUE\"\n  | \"SYSEX\"\n  | \"OTHER\";\n\nexport interface MidiData {\n  kind: MidiKind;\n  channel?: number;\n  data: number[];\n  note?: number;\n  vel?: number;\n  cc?: number;\n  value?: number;\n  program?: number;\n  pitchBend?: number;\n}\n\nexport interface SerialData {\n  line: string;\n}\n\nexport interface LogEntry {\n  id: string;\n  tAbsMs: number;      // Date.now()\n  tRelMs: number;      // performance.now() - t0\n  tDeltaMs: number;    // since previous entry\n  source: LogSource;\n  text: string;        // human-readable line\n  midi?: MidiData;\n  serial?: SerialData;\n}\n\n// ============================================================\n// Settings\n// ============================================================\n\nexport interface AppSettings {\n  midiChannel: number;\n  ccMapping: {\n    cutoff: number;\n    resonance: number;\n    envMod: number;\n    decay: number;\n    accent: number;\n    volume: number;\n  };\n  accentMode: \"velocity\" | \"cc\";\n  accentVelocity: number;\n  accentCC: number;\n  accentValue: number;\n  slideMode: \"legato\" | \"cc\";\n  slideCC: number;\n  serialBaudRate: number;\n  logMaxEntries: number;\n  showRawBytes: boolean;\n  showDeltaTimes: boolean;\n}\n\nexport const DEFAULT_SETTINGS: AppSettings = {\n  midiChannel: 1,\n  ccMapping: {\n    cutoff: 74,\n    resonance: 71,\n    envMod: 75,\n    decay: 76,\n    accent: 77,\n    volume: 7,\n  },\n  accentMode: \"velocity\",\n  accentVelocity: 120,\n  accentCC: 77,\n  accentValue: 127,\n  slideMode: \"legato\",\n  slideCC: 65,\n  serialBaudRate: 115200,\n  logMaxEntries: 10000,\n  showRawBytes: false,\n  showDeltaTimes: true,\n};\n\n// ============================================================\n// MIDI Utilities\n// ============================================================\n\nexport function midiNoteToName(note: number): string {\n  const names = [\"C\", \"C#\", \"D\", \"D#\", \"E\", \"F\", \"F#\", \"G\", \"G#\", \"A\", \"A#\", \"B\"];\n  const octave = Math.floor(note / 12) - 1;\n  const noteName = names[note % 12];\n  return `${noteName}${octave}`;\n}\n\nexport function parseMidiMessage(data: number[]): MidiData {\n  if (data.length === 0) {\n    return { kind: \"OTHER\", data };\n  }\n\n  const status = data[0];\n  const messageType = status & 0xf0;\n  const channel = (status & 0x0f) + 1;\n\n  switch (messageType) {\n    case 0x90: // Note On\n      return {\n        kind: data[2] > 0 ? \"NOTE_ON\" : \"NOTE_OFF\",\n        channel,\n        data,\n        note: data[1],\n        vel: data[2],\n      };\n\n    case 0x80: // Note Off\n      return {\n        kind: \"NOTE_OFF\",\n        channel,\n        data,\n        note: data[1],\n        vel: data[2],\n      };\n\n    case 0xb0: // Control Change\n      return {\n        kind: \"CC\",\n        channel,\n        data,\n        cc: data[1],\n        value: data[2],\n      };\n\n    case 0xc0: // Program Change\n      return {\n        kind: \"PC\",\n        channel,\n        data,\n        program: data[1],\n      };\n\n    case 0xe0: // Pitch Bend\n      const value14bit = data[1] | (data[2] << 7);\n      return {\n        kind: \"PB\",\n        channel,\n        data,\n        pitchBend: value14bit - 8192,\n      };\n\n    default:\n      // System messages\n      if (status === 0xf8) return { kind: \"CLOCK\", data };\n      if (status === 0xfa) return { kind: \"START\", data };\n      if (status === 0xfc) return { kind: \"STOP\", data };\n      if (status === 0xfb) return { kind: \"CONTINUE\", data };\n      if (status === 0xf0) return { kind: \"SYSEX\", data };\n      \n      return { kind: \"OTHER\", data };\n  }\n}\n\nexport function formatMidiMessage(midi: MidiData): string {\n  switch (midi.kind) {\n    case \"NOTE_ON\":\n      return `NOTE_ON  ch${midi.channel} note=${midi.note} (${midiNoteToName(midi.note!)}) vel=${midi.vel}`;\n    case \"NOTE_OFF\":\n      return `NOTE_OFF ch${midi.channel} note=${midi.note} (${midiNoteToName(midi.note!)}) vel=${midi.vel}`;\n    case \"CC\":\n      return `CC       ch${midi.channel} cc=${midi.cc} val=${midi.value}`;\n    case \"PC\":\n      return `PC       ch${midi.channel} program=${midi.program}`;\n    case \"PB\":\n      return `PB       ch${midi.channel} value=${midi.pitchBend}`;\n    case \"CLOCK\":\n      return \"CLOCK\";\n    case \"START\":\n      return \"START\";\n    case \"STOP\":\n      return \"STOP\";\n    case \"CONTINUE\":\n      return \"CONTINUE\";\n    case \"SYSEX\":\n      return `SYSEX    len=${midi.data.length}`;\n    default:\n      return `OTHER    ${midi.data.map(b => b.toString(16).padStart(2, '0')).join(' ')}`;\n  }\n}\n\nexport function formatTime(ms: number): string {\n  const date = new Date(ms);\n  const hours = date.getHours().toString().padStart(2, '0');\n  const minutes = date.getMinutes().toString().padStart(2, '0');\n  const seconds = date.getSeconds().toString().padStart(2, '0');\n  const millis = date.getMilliseconds().toString().padStart(3, '0');\n  return `${hours}:${minutes}:${seconds}.${millis}`;\n}\n\nexport function formatDelta(ms: number): string {\n  if (ms < 1000) {\n    return `+${ms.toFixed(0)}ms`;\n  } else {\n    return `+${(ms / 1000).toFixed(2)}s`;\n  }\n}\n","import { EventBus } from './eventBus';\nimport { parseMidiMessage } from './types';\n\n// BLE MIDI Service UUIDs (standard BLE MIDI spec)\nconst BLE_MIDI_SERVICE = '03b80e5a-ede8-4b33-a751-6ce34ec4c700';\nconst BLE_MIDI_CHARACTERISTIC = '7772e5db-3868-4112-a1a9-f2669d106bf3';\n\nexport class BleMidiConnection {\n  private device: BluetoothDevice | null = null;\n  private characteristic: BluetoothRemoteGATTCharacteristic | null = null;\n  private eventBus: EventBus;\n  public connected = false;\n\n  constructor(eventBus: EventBus) {\n    this.eventBus = eventBus;\n  }\n\n  async connect(): Promise<void> {\n    try {\n      // Request device\n      this.device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: [BLE_MIDI_SERVICE] }],\n      });\n\n      if (!this.device.gatt) {\n        throw new Error('GATT not available');\n      }\n\n      // Connect to GATT server\n      const server = await this.device.gatt.connect();\n\n      // Get MIDI service\n      const service = await server.getPrimaryService(BLE_MIDI_SERVICE);\n\n      // Get MIDI characteristic\n      this.characteristic = await service.getCharacteristic(BLE_MIDI_CHARACTERISTIC);\n\n      // Subscribe to notifications\n      await this.characteristic.startNotifications();\n      this.characteristic.addEventListener('characteristicvaluechanged', this.handleNotification.bind(this));\n\n      // Listen for disconnection\n      this.device.addEventListener('gattserverdisconnected', this.handleDisconnect.bind(this));\n\n      this.connected = true;\n      console.log('BLE MIDI connected');\n    } catch (error) {\n      console.error('BLE MIDI connection failed:', error);\n      throw error;\n    }\n  }\n\n  async disconnect(): Promise<void> {\n    if (this.device?.gatt?.connected) {\n      this.device.gatt.disconnect();\n    }\n    this.connected = false;\n  }\n\n  private handleNotification(event: Event): void {\n    const target = event.target as BluetoothRemoteGATTCharacteristic;\n    const value = target.value;\n    if (!value) return;\n\n    // Parse BLE MIDI packet\n    // Format: [header][timestamp][midi bytes...]\n    const data = new Uint8Array(value.buffer);\n    \n    // Skip header byte and timestamp byte, extract MIDI message\n    const midiBytes: number[] = [];\n    for (let i = 2; i < data.length; i++) {\n      // Skip timestamp bytes (high bit set)\n      if ((data[i] & 0x80) === 0 || i === 2) {\n        midiBytes.push(data[i]);\n      }\n    }\n\n    if (midiBytes.length > 0) {\n      const midi = parseMidiMessage(midiBytes);\n      \n      this.eventBus.emit({\n        source: 'BLE_IN',\n        text: `BLE←MIDI ${this.formatMidiBytes(midiBytes)}`,\n        tDeltaMs: 0, // Will be calculated by logger\n        midi,\n      });\n    }\n  }\n\n  private handleDisconnect(): void {\n    this.connected = false;\n    this.characteristic = null;\n    console.log('BLE MIDI disconnected');\n  }\n\n  async sendMidi(status: number, data1: number, data2?: number): Promise<void> {\n    if (!this.characteristic || !this.connected) {\n      throw new Error('BLE MIDI not connected');\n    }\n\n    // Build BLE MIDI packet\n    // Format: [header][timestamp][status][data1][data2?]\n    const header = 0x80;\n    const timestamp = 0x80; // Simplified timestamp\n    \n    const bytes = data2 !== undefined\n      ? [header, timestamp, status, data1, data2]\n      : [header, timestamp, status, data1];\n\n    await this.characteristic.writeValue(new Uint8Array(bytes));\n\n    // Log outgoing MIDI\n    const midiBytes = data2 !== undefined ? [status, data1, data2] : [status, data1];\n    const midi = parseMidiMessage(midiBytes);\n    \n    this.eventBus.emit({\n      source: 'BLE_OUT',\n      text: `BLE→MIDI ${this.formatMidiBytes(midiBytes)}`,\n      tDeltaMs: 0,\n      midi,\n    });\n  }\n\n  private formatMidiBytes(bytes: number[]): string {\n    return bytes.map(b => b.toString(16).padStart(2, '0')).join(' ');\n  }\n\n  isSupported(): boolean {\n    return 'bluetooth' in navigator;\n  }\n}\n","import { EventBus } from './eventBus';\n\nexport class SerialConnection {\n  private port: SerialPort | null = null;\n  private reader: ReadableStreamDefaultReader<string> | null = null;\n  private eventBus: EventBus;\n  private baudRate: number;\n  public connected = false;\n\n  constructor(eventBus: EventBus, baudRate = 115200) {\n    this.eventBus = eventBus;\n    this.baudRate = baudRate;\n  }\n\n  async connect(): Promise<void> {\n    try {\n      // Request serial port\n      this.port = await navigator.serial.requestPort();\n\n      // Open port\n      await this.port.open({ baudRate: this.baudRate });\n\n      this.connected = true;\n\n      // Start reading\n      this.startReading();\n\n      console.log('Serial connected');\n    } catch (error) {\n      console.error('Serial connection failed:', error);\n      throw error;\n    }\n  }\n\n  async disconnect(): Promise<void> {\n    if (this.reader) {\n      await this.reader.cancel();\n      this.reader = null;\n    }\n\n    if (this.port) {\n      await this.port.close();\n      this.port = null;\n    }\n\n    this.connected = false;\n  }\n\n  private async startReading(): Promise<void> {\n    if (!this.port || !this.port.readable) return;\n\n    const textDecoder = new TextDecoderStream();\n    const readableStreamClosed = this.port.readable.pipeTo(textDecoder.writable as any);\n    this.reader = textDecoder.readable.getReader();\n\n    let buffer = '';\n\n    try {\n      while (true) {\n        const { value, done } = await this.reader.read();\n        if (done) {\n          break;\n        }\n\n        buffer += value;\n        \n        // Process complete lines\n        const lines = buffer.split('\\n');\n        buffer = lines.pop() || ''; // Keep incomplete line in buffer\n\n        for (const line of lines) {\n          const trimmed = line.trim();\n          if (trimmed) {\n            this.eventBus.emit({\n              source: 'SERIAL_IN',\n              text: `SERIAL  ${trimmed}`,\n              tDeltaMs: 0,\n              serial: { line: trimmed },\n            });\n          }\n        }\n      }\n    } catch (error) {\n      console.error('Serial read error:', error);\n    } finally {\n      this.reader.releaseLock();\n      await readableStreamClosed.catch(() => { /* ignore */ });\n    }\n  }\n\n  async sendCommand(command: string): Promise<void> {\n    if (!this.port || !this.port.writable) {\n      throw new Error('Serial not connected');\n    }\n\n    const writer = this.port.writable.getWriter();\n    const encoder = new TextEncoder();\n    await writer.write(encoder.encode(command + '\\n'));\n    writer.releaseLock();\n\n    // Log outgoing command\n    this.eventBus.emit({\n      source: 'SERIAL_OUT',\n      text: `SERIAL→ ${command}`,\n      tDeltaMs: 0,\n      serial: { line: command },\n    });\n  }\n\n  isSupported(): boolean {\n    return 'serial' in navigator;\n  }\n\n  setBaudRate(baudRate: number): void {\n    this.baudRate = baudRate;\n  }\n}\n","import type { LogEntry, LogSource } from './types';\nimport { formatTime, formatDelta, formatMidiMessage } from './types';\nimport { EventBus } from './eventBus';\n\nexport interface LoggerConfig {\n  maxEntries: number;\n  autoScroll: boolean;\n  showDelta: boolean;\n  filters: Set<LogSource>;\n  searchTerm: string;\n}\n\nexport class Logger {\n  private entries: LogEntry[] = [];\n  private config: LoggerConfig;\n  private paused = false;\n  private lastEntryTime = 0;\n  private eventBus: EventBus;\n\n  constructor(eventBus: EventBus, config: Partial<LoggerConfig> = {}) {\n    this.eventBus = eventBus;\n    this.config = {\n      maxEntries: config.maxEntries || 10000,\n      autoScroll: config.autoScroll !== false,\n      showDelta: config.showDelta !== false,\n      filters: config.filters || new Set(['BLE_IN', 'BLE_OUT', 'SERIAL_IN', 'UI_TO_MIDI']),\n      searchTerm: config.searchTerm || '',\n    };\n\n    // Subscribe to event bus\n    this.eventBus.subscribe((entry) => {\n      if (!this.paused) {\n        this.addEntry(entry);\n      }\n    });\n  }\n\n  private addEntry(entry: LogEntry): void {\n    // Calculate delta time\n    if (this.lastEntryTime > 0) {\n      entry.tDeltaMs = entry.tRelMs - this.lastEntryTime;\n    } else {\n      entry.tDeltaMs = 0;\n    }\n    this.lastEntryTime = entry.tRelMs;\n\n    // Add to ring buffer\n    this.entries.push(entry);\n    if (this.entries.length > this.config.maxEntries) {\n      this.entries.shift();\n    }\n  }\n\n  getEntries(): LogEntry[] {\n    let filtered = this.entries;\n\n    // Apply source filter\n    filtered = filtered.filter(entry => this.config.filters.has(entry.source));\n\n    // Apply search filter\n    if (this.config.searchTerm) {\n      const term = this.config.searchTerm.toLowerCase();\n      filtered = filtered.filter(entry => entry.text.toLowerCase().includes(term));\n    }\n\n    return filtered;\n  }\n\n  clear(): void {\n    this.entries = [];\n    this.lastEntryTime = 0;\n    this.eventBus.reset();\n  }\n\n  pause(): void {\n    this.paused = true;\n  }\n\n  resume(): void {\n    this.paused = false;\n  }\n\n  isPaused(): boolean {\n    return this.paused;\n  }\n\n  updateConfig(updates: Partial<LoggerConfig>): void {\n    this.config = { ...this.config, ...updates };\n  }\n\n  exportJson(): string {\n    return JSON.stringify(this.entries, null, 2);\n  }\n\n  exportCsv(): string {\n    const headers = ['Timestamp', 'Relative (ms)', 'Delta (ms)', 'Source', 'Type', 'Details'];\n    const rows = this.entries.map(entry => {\n      const details = entry.midi\n        ? formatMidiMessage(entry.midi)\n        : entry.serial?.line || '';\n      \n      return [\n        formatTime(entry.tAbsMs),\n        entry.tRelMs.toFixed(3),\n        entry.tDeltaMs.toFixed(3),\n        entry.source,\n        entry.midi?.kind || 'SERIAL',\n        details,\n      ];\n    });\n\n    const csvRows = [headers, ...rows];\n    return csvRows.map(row => row.map(cell => `\"${cell}\"`).join(',')).join('\\n');\n  }\n\n  formatEntry(entry: LogEntry): string {\n    let output = '';\n\n    // Timestamp\n    output += `<span class=\"timestamp\">${formatTime(entry.tAbsMs)}</span>`;\n\n    // Delta time (optional)\n    if (this.config.showDelta && entry.tDeltaMs > 0) {\n      output += `<span class=\"timestamp\"> ${formatDelta(entry.tDeltaMs)}</span>`;\n    }\n\n    // Source\n    const sourceLabel = this.formatSource(entry.source);\n    output += `<span class=\"source\">${sourceLabel}</span>`;\n\n    // Message details\n    if (entry.midi) {\n      output += formatMidiMessage(entry.midi);\n    } else if (entry.serial) {\n      output += entry.serial.line;\n    } else {\n      output += entry.text;\n    }\n\n    return output;\n  }\n\n  private formatSource(source: LogSource): string {\n    switch (source) {\n      case 'UI_TO_MIDI':\n        return 'UI→MIDI';\n      case 'BLE_IN':\n        return 'CYD←BLE';\n      case 'BLE_OUT':\n        return 'CYD→BLE';\n      case 'SERIAL_IN':\n        return 'CYD→SER';\n      case 'SERIAL_OUT':\n        return 'SER→CYD';\n    }\n  }\n\n  getSourceClass(source: LogSource): string {\n    switch (source) {\n      case 'UI_TO_MIDI':\n      case 'BLE_OUT':\n        return 'midi-out';\n      case 'BLE_IN':\n        return 'midi-in';\n      case 'SERIAL_IN':\n      case 'SERIAL_OUT':\n        return 'serial-in';\n    }\n  }\n}\n","import { EventBus } from './eventBus';\nimport { BleMidiConnection } from './bleMidi';\nimport { SerialConnection } from './serial';\nimport { Logger } from './logger';\nimport type { AppSettings } from './types';\nimport { DEFAULT_SETTINGS } from './types';\n\nexport class MidiController {\n  private bleMidi: BleMidiConnection;\n  private serial: SerialConnection;\n  private logger: Logger;\n  private eventBus: EventBus;\n  private settings: AppSettings;\n  \n  // State\n  private currentOctave = 3;\n  private gateEnabled = false;\n  private accentEnabled = false;\n  private slideEnabled = false;\n  private activeNotes = new Set<number>();\n  private knobValues = new Map<string, number>();\n\n  constructor(eventBus: EventBus) {\n    this.eventBus = eventBus;\n    this.settings = { ...DEFAULT_SETTINGS };\n    this.bleMidi = new BleMidiConnection(eventBus);\n    this.serial = new SerialConnection(eventBus, this.settings.serialBaudRate);\n    this.logger = new Logger(eventBus, {\n      maxEntries: this.settings.logMaxEntries,\n      showDelta: this.settings.showDeltaTimes,\n    });\n\n    // Initialize knob values\n    Object.entries(this.settings.ccMapping).forEach(([name, cc]) => {\n      this.knobValues.set(name, 64); // Default mid value\n    });\n  }\n\n  // Connection management\n  async connectBle(): Promise<void> {\n    await this.bleMidi.connect();\n  }\n\n  async disconnectBle(): Promise<void> {\n    await this.bleMidi.disconnect();\n  }\n\n  async connectSerial(): Promise<void> {\n    await this.serial.connect();\n  }\n\n  async disconnectSerial(): Promise<void> {\n    await this.serial.disconnect();\n  }\n\n  isBleConnected(): boolean {\n    return this.bleMidi.connected;\n  }\n\n  isSerialConnected(): boolean {\n    return this.serial.connected;\n  }\n\n  // MIDI operations\n  async sendNoteOn(note: number, velocity?: number): Promise<void> {\n    const vel = velocity ?? (this.accentEnabled && this.settings.accentMode === 'velocity'\n      ? this.settings.accentVelocity\n      : 100);\n    \n    const status = 0x90 | (this.settings.midiChannel - 1);\n    await this.bleMidi.sendMidi(status, note, vel);\n    \n    this.activeNotes.add(note);\n\n    // Log UI action\n    this.eventBus.emit({\n      source: 'UI_TO_MIDI',\n      text: `UI→MIDI NOTE_ON note=${note} vel=${vel}`,\n      tDeltaMs: 0,\n      midi: {\n        kind: 'NOTE_ON',\n        channel: this.settings.midiChannel,\n        data: [status, note, vel],\n        note,\n        vel,\n      },\n    });\n  }\n\n  async sendNoteOff(note: number): Promise<void> {\n    const status = 0x80 | (this.settings.midiChannel - 1);\n    await this.bleMidi.sendMidi(status, note, 0);\n    \n    this.activeNotes.delete(note);\n\n    // Log UI action\n    this.eventBus.emit({\n      source: 'UI_TO_MIDI',\n      text: `UI→MIDI NOTE_OFF note=${note}`,\n      tDeltaMs: 0,\n      midi: {\n        kind: 'NOTE_OFF',\n        channel: this.settings.midiChannel,\n        data: [status, note, 0],\n        note,\n        vel: 0,\n      },\n    });\n  }\n\n  async sendCC(cc: number, value: number): Promise<void> {\n    const status = 0xb0 | (this.settings.midiChannel - 1);\n    await this.bleMidi.sendMidi(status, cc, value);\n\n    // Log UI action\n    this.eventBus.emit({\n      source: 'UI_TO_MIDI',\n      text: `UI→MIDI CC cc=${cc} val=${value}`,\n      tDeltaMs: 0,\n      midi: {\n        kind: 'CC',\n        channel: this.settings.midiChannel,\n        data: [status, cc, value],\n        cc,\n        value,\n      },\n    });\n  }\n\n  async allNotesOff(): Promise<void> {\n    // Send All Notes Off (CC 123)\n    const status = 0xb0 | (this.settings.midiChannel - 1);\n    await this.bleMidi.sendMidi(status, 123, 0);\n    \n    // Send All Sound Off (CC 120)\n    await this.bleMidi.sendMidi(status, 120, 0);\n\n    // Also send note offs for all active notes\n    for (const note of this.activeNotes) {\n      await this.sendNoteOff(note);\n    }\n\n    this.activeNotes.clear();\n  }\n\n  async sendTestBurst(): Promise<void> {\n    // Send a deterministic sequence for testing\n    const testSequence = [\n      // Note sequence\n      { type: 'note', note: 60, vel: 100 },\n      { type: 'delay', ms: 100 },\n      { type: 'note', note: 64, vel: 100 },\n      { type: 'delay', ms: 100 },\n      { type: 'note', note: 67, vel: 100 },\n      { type: 'delay', ms: 100 },\n      // CC sweep\n      { type: 'cc', cc: 74, value: 0 },\n      { type: 'delay', ms: 50 },\n      { type: 'cc', cc: 74, value: 64 },\n      { type: 'delay', ms: 50 },\n      { type: 'cc', cc: 74, value: 127 },\n      { type: 'delay', ms: 100 },\n      // Note offs\n      { type: 'noteOff', note: 60 },\n      { type: 'noteOff', note: 64 },\n      { type: 'noteOff', note: 67 },\n    ];\n\n    for (const item of testSequence) {\n      if (item.type === 'note') {\n        await this.sendNoteOn((item as any).note, (item as any).vel);\n      } else if (item.type === 'noteOff') {\n        await this.sendNoteOff((item as any).note);\n      } else if (item.type === 'cc') {\n        await this.sendCC((item as any).cc, (item as any).value);\n      } else if (item.type === 'delay') {\n        await new Promise(resolve => setTimeout(resolve, (item as any).ms));\n      }\n    }\n  }\n\n  // State management\n  setOctave(octave: number): void {\n    this.currentOctave = Math.max(0, Math.min(8, octave));\n  }\n\n  getOctave(): number {\n    return this.currentOctave;\n  }\n\n  toggleGate(): void {\n    this.gateEnabled = !this.gateEnabled;\n  }\n\n  isGateEnabled(): boolean {\n    return this.gateEnabled;\n  }\n\n  toggleAccent(): void {\n    this.accentEnabled = !this.accentEnabled;\n  }\n\n  isAccentEnabled(): boolean {\n    return this.accentEnabled;\n  }\n\n  toggleSlide(): void {\n    this.slideEnabled = !this.slideEnabled;\n  }\n\n  isSlideEnabled(): boolean {\n    return this.slideEnabled;\n  }\n\n  setKnobValue(name: string, value: number): void {\n    this.knobValues.set(name, value);\n  }\n\n  getKnobValue(name: string): number {\n    return this.knobValues.get(name) || 64;\n  }\n\n  // Logger access\n  getLogger(): Logger {\n    return this.logger;\n  }\n\n  // Settings\n  getSettings(): AppSettings {\n    return { ...this.settings };\n  }\n\n  updateSettings(updates: Partial<AppSettings>): void {\n    this.settings = { ...this.settings, ...updates };\n    \n    // Update serial baud rate if changed\n    if (updates.serialBaudRate !== undefined) {\n      this.serial.setBaudRate(updates.serialBaudRate);\n    }\n\n    // Update logger config if needed\n    if (updates.logMaxEntries !== undefined || updates.showDeltaTimes !== undefined) {\n      this.logger.updateConfig({\n        maxEntries: this.settings.logMaxEntries,\n        showDelta: this.settings.showDeltaTimes,\n      });\n    }\n  }\n}\n","/**\n * TB-303 Bass Synthesizer\n * A simplified Web Audio API implementation inspired by the Roland TB-303\n * \n * Features:\n * - Sawtooth and square oscillators\n * - Resonant lowpass filter with envelope modulation\n * - Accent and slide\n * - Monophonic with note priority\n */\n\nexport interface Synth303Params {\n  waveform: 'saw' | 'square';\n  cutoff: number;        // 0-1\n  resonance: number;     // 0-1\n  envMod: number;        // 0-1\n  decay: number;         // 0-1\n  accent: number;        // 0-1\n  volume: number;        // 0-1\n}\n\nexport class Synth303 {\n  private audioContext: AudioContext;\n  private masterGain: GainNode;\n  \n  // Oscillator and filter\n  private osc: OscillatorNode | null = null;\n  private oscGain: GainNode;\n  private filter: BiquadFilterNode;\n  private filterEnv: GainNode;\n  \n  // Current state\n  private currentNote: number | null = null;\n  private slideMode = false;\n  private accentMode = false;\n  \n  // Parameters\n  private params: Synth303Params = {\n    waveform: 'saw',\n    cutoff: 0.5,\n    resonance: 0.7,\n    envMod: 0.5,\n    decay: 0.3,\n    accent: 0.5,\n    volume: 0.5,\n  };\n  \n  constructor() {\n    this.audioContext = new AudioContext();\n    \n    // Create audio graph\n    this.masterGain = this.audioContext.createGain();\n    this.masterGain.gain.value = this.params.volume;\n    this.masterGain.connect(this.audioContext.destination);\n    \n    // Oscillator gain (for envelope)\n    this.oscGain = this.audioContext.createGain();\n    this.oscGain.gain.value = 0;\n    \n    // Filter\n    this.filter = this.audioContext.createBiquadFilter();\n    this.filter.type = 'lowpass';\n    this.filter.Q.value = 1; // Will be modulated by resonance\n    \n    // Filter envelope modulation\n    this.filterEnv = this.audioContext.createGain();\n    this.filterEnv.gain.value = 0;\n    \n    // Connect graph: osc -> oscGain -> filter -> masterGain -> destination\n    this.oscGain.connect(this.filter);\n    this.filter.connect(this.masterGain);\n    \n    // Update filter from params\n    this.updateFilter();\n  }\n  \n  /**\n   * Start or resume the audio context (required after user interaction)\n   */\n  async start(): Promise<void> {\n    if (this.audioContext.state === 'suspended') {\n      await this.audioContext.resume();\n    }\n  }\n  \n  /**\n   * Handle MIDI Note On\n   */\n  noteOn(note: number, velocity: number = 100): void {\n    const now = this.audioContext.currentTime;\n    const frequency = this.midiNoteToFrequency(note);\n    const normalizedVel = velocity / 127;\n    const accentBoost = this.accentMode ? this.params.accent : 0;\n    const effectiveVel = Math.min(1, normalizedVel + accentBoost * 0.5);\n    \n    // If we're already playing a note, handle slide\n    if (this.currentNote !== null && this.osc) {\n      if (this.slideMode) {\n        // Slide to new frequency\n        this.osc.frequency.cancelScheduledValues(now);\n        this.osc.frequency.linearRampToValueAtTime(frequency, now + 0.1);\n        this.currentNote = note;\n        return;\n      } else {\n        // Stop previous note\n        this.noteOff(this.currentNote);\n      }\n    }\n    \n    // Create new oscillator\n    this.osc = this.audioContext.createOscillator();\n    this.osc.type = this.params.waveform === 'square' ? 'square' : 'sawtooth';\n    this.osc.frequency.value = frequency;\n    this.osc.connect(this.oscGain);\n    this.osc.start(now);\n    \n    // Amplitude envelope (simple AR)\n    this.oscGain.gain.cancelScheduledValues(now);\n    this.oscGain.gain.setValueAtTime(0, now);\n    this.oscGain.gain.linearRampToValueAtTime(effectiveVel * 0.6, now + 0.001);\n    \n    // Filter envelope\n    const baseCutoff = 50 + this.params.cutoff * 1950; // 50 - 2000 Hz\n    const envAmount = this.params.envMod * 3000; // Up to +3000 Hz\n    const accentEnvBoost = this.accentMode ? this.params.accent * 2000 : 0;\n    const peakCutoff = Math.min(20000, baseCutoff + envAmount + accentEnvBoost);\n    const decayTime = 0.05 + this.params.decay * 1.5; // 50ms to 1.55s\n    \n    this.filter.frequency.cancelScheduledValues(now);\n    this.filter.frequency.setValueAtTime(peakCutoff, now);\n    this.filter.frequency.exponentialRampToValueAtTime(\n      Math.max(baseCutoff, 50),\n      now + decayTime\n    );\n    \n    this.currentNote = note;\n  }\n  \n  /**\n   * Handle MIDI Note Off\n   */\n  noteOff(note: number): void {\n    if (this.currentNote !== note) {\n      return;\n    }\n    \n    const now = this.audioContext.currentTime;\n    \n    // Quick release\n    this.oscGain.gain.cancelScheduledValues(now);\n    this.oscGain.gain.linearRampToValueAtTime(0, now + 0.05);\n    \n    // Stop oscillator after release\n    if (this.osc) {\n      this.osc.stop(now + 0.06);\n      this.osc = null;\n    }\n    \n    this.currentNote = null;\n  }\n  \n  /**\n   * All notes off (panic)\n   */\n  allNotesOff(): void {\n    const now = this.audioContext.currentTime;\n    \n    this.oscGain.gain.cancelScheduledValues(now);\n    this.oscGain.gain.setValueAtTime(0, now);\n    \n    if (this.osc) {\n      this.osc.stop(now + 0.01);\n      this.osc = null;\n    }\n    \n    this.currentNote = null;\n  }\n  \n  /**\n   * Handle MIDI CC\n   */\n  handleCC(cc: number, value: number): void {\n    const normalized = value / 127;\n    \n    switch (cc) {\n      case 7:  // Volume\n        this.setParam('volume', normalized);\n        break;\n      case 71: // Resonance\n        this.setParam('resonance', normalized);\n        break;\n      case 74: // Cutoff\n        this.setParam('cutoff', normalized);\n        break;\n      case 75: // Env Mod\n        this.setParam('envMod', normalized);\n        break;\n      case 76: // Decay\n        this.setParam('decay', normalized);\n        break;\n      case 77: // Accent\n        this.setParam('accent', normalized);\n        break;\n      case 65: // Slide (portamento)\n        this.slideMode = value >= 64;\n        break;\n    }\n  }\n  \n  /**\n   * Set synth parameter\n   */\n  setParam(param: keyof Synth303Params, value: number | string): void {\n    if (param === 'waveform') {\n      if (value === 'saw' || value === 'square') {\n        this.params.waveform = value;\n      }\n    } else {\n      // Numeric parameters only\n      const numValue = typeof value === 'number' ? value : parseFloat(String(value));\n      if (!isNaN(numValue)) {\n        (this.params as any)[param] = Math.max(0, Math.min(1, numValue));\n      }\n    }\n    \n    // Update audio parameters\n    if (param === 'volume') {\n      this.masterGain.gain.setValueAtTime(\n        this.params.volume,\n        this.audioContext.currentTime\n      );\n    } else if (param === 'cutoff' || param === 'resonance') {\n      this.updateFilter();\n    }\n  }\n  \n  /**\n   * Get current parameter value\n   */\n  getParam(param: keyof Synth303Params): number | string {\n    return this.params[param];\n  }\n  \n  /**\n   * Toggle accent mode\n   */\n  setAccent(enabled: boolean): void {\n    this.accentMode = enabled;\n  }\n  \n  /**\n   * Toggle slide mode\n   */\n  setSlide(enabled: boolean): void {\n    this.slideMode = enabled;\n  }\n  \n  /**\n   * Update filter parameters\n   */\n  private updateFilter(): void {\n    // Resonance: Q from 1 to 20\n    const q = 1 + this.params.resonance * 19;\n    this.filter.Q.setValueAtTime(q, this.audioContext.currentTime);\n  }\n  \n  /**\n   * Convert MIDI note to frequency\n   */\n  private midiNoteToFrequency(note: number): number {\n    return 440 * Math.pow(2, (note - 69) / 12);\n  }\n  \n  /**\n   * Get audio context (for cleanup)\n   */\n  getContext(): AudioContext {\n    return this.audioContext;\n  }\n}\n","import './style.css';\nimport { EventBus } from './eventBus';\nimport { MidiController } from './controller';\nimport { Synth303 } from './synth303';\nimport { formatTime, formatDelta, formatMidiMessage } from './types';\nimport type { LogEntry } from './types';\n\n// Initialize app\nconst eventBus = new EventBus();\nconst controller = new MidiController(eventBus);\nconst logger = controller.getLogger();\nconst synth = new Synth303();\n\n// ============================================================\n// UI Elements\n// ============================================================\n\nconst $ = (id: string) => document.getElementById(id)!;\n\n// Connection buttons\nconst connectBleBtn = $('connect-ble') as HTMLButtonElement;\nconst connectSerialBtn = $('connect-serial') as HTMLButtonElement;\nconst bleStatus = $('ble-status');\nconst serialStatus = $('serial-status');\nconst bleLabel = $('ble-label');\nconst serialLabel = $('serial-label');\n\n// Synth visualizer\nconst synthCanvas = $('synth-canvas') as HTMLCanvasElement;\nconst cutoffDisplay = $('cutoff-display');\nconst resonanceDisplay = $('resonance-display');\nconst envmodDisplay = $('envmod-display');\nconst decayDisplay = $('decay-display');\nconst accentDisplay = $('accent-display');\nconst volumeDisplay = $('volume-display');\n\n// Log controls - Unified\nconst searchBox = $('search-box') as HTMLInputElement;\nconst filterMidi = $('filter-midi') as HTMLInputElement;\nconst filterSerial = $('filter-serial') as HTMLInputElement;\nconst autoScrollCheck = $('auto-scroll') as HTMLInputElement;\nconst showDeltaCheck = $('show-delta') as HTMLInputElement;\nconst pauseLogBtn = $('pause-log');\nconst clearLogBtn = $('clear-log');\nconst saveLogBtn = $('save-log');\nconst logViewer = $('log-viewer');\n\n// ============================================================\n// Synth Visualizer Setup\n// ============================================================\n\nfunction setupSynthVisualizer(): void {\n  const ctx = synthCanvas.getContext('2d')!;\n  const width = synthCanvas.width = synthCanvas.offsetWidth;\n  const height = synthCanvas.height = synthCanvas.offsetHeight;\n  \n  let animationId: number;\n  \n  function draw() {\n    ctx.fillStyle = '#1a1a1a';\n    ctx.fillRect(0, 0, width, height);\n    \n    // Draw simple waveform visualization\n    ctx.strokeStyle = '#00d4ff';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    \n    const centerY = height / 2;\n    const time = performance.now() / 1000;\n    \n    for (let x = 0; x < width; x++) {\n      const t = (x / width) * Math.PI * 4 + time * 2;\n      const y = centerY + Math.sin(t) * (height * 0.3);\n      \n      if (x === 0) {\n        ctx.moveTo(x, y);\n      } else {\n        ctx.lineTo(x, y);\n      }\n    }\n    \n    ctx.stroke();\n    \n    // Continue animation\n    animationId = requestAnimationFrame(draw);\n  }\n  \n  draw();\n}\n\n// ============================================================\n// MIDI Event Handler - Connect to Synth\n// ============================================================\n\neventBus.subscribe((entry) => {\n  // Play incoming MIDI on synth\n  if (entry.midi && (entry.source === 'BLE_IN' || entry.source === 'UI_TO_MIDI')) {\n    const midi = entry.midi;\n    \n    switch (midi.kind) {\n      case 'NOTE_ON':\n        if (midi.note !== undefined && midi.vel !== undefined) {\n          synth.noteOn(midi.note, midi.vel);\n        }\n        break;\n        \n      case 'NOTE_OFF':\n        if (midi.note !== undefined) {\n          synth.noteOff(midi.note);\n        }\n        break;\n        \n      case 'CC':\n        if (midi.cc !== undefined && midi.value !== undefined) {\n          synth.handleCC(midi.cc, midi.value);\n          updateSynthDisplay();\n        }\n        break;\n    }\n  }\n});\n\nfunction updateSynthDisplay(): void {\n  cutoffDisplay.textContent = Math.round((synth.getParam('cutoff') as number) * 100) + '%';\n  resonanceDisplay.textContent = Math.round((synth.getParam('resonance') as number) * 100) + '%';\n  envmodDisplay.textContent = Math.round((synth.getParam('envMod') as number) * 100) + '%';\n  decayDisplay.textContent = Math.round((synth.getParam('decay') as number) * 100) + '%';\n  accentDisplay.textContent = Math.round((synth.getParam('accent') as number) * 100) + '%';\n  volumeDisplay.textContent = Math.round((synth.getParam('volume') as number) * 100) + '%';\n}\n\n// ============================================================\n// Event Handlers\n// ============================================================\n\nconnectBleBtn.addEventListener('click', async () => {\n  try {\n    await controller.connectBle();\n    await synth.start(); // Resume audio context on user interaction\n    updateConnectionStatus();\n  } catch (error) {\n    alert(`BLE connection failed: ${error}`);\n  }\n});\n\nconnectSerialBtn.addEventListener('click', async () => {\n  try {\n    await controller.connectSerial();\n    updateConnectionStatus();\n  } catch (error) {\n    alert(`Serial connection failed: ${error}`);\n  }\n});\n\n// Log controls - Unified\nsearchBox.addEventListener('input', () => {\n  renderLog();\n});\n\nfilterMidi.addEventListener('change', () => {\n  renderLog();\n});\n\nfilterSerial.addEventListener('change', () => {\n  renderLog();\n});\n\nautoScrollCheck.addEventListener('change', () => {\n  // Auto-scroll is handled per render\n});\n\nshowDeltaCheck.addEventListener('change', () => {\n  renderLog();\n});\n\npauseLogBtn.addEventListener('click', () => {\n  if (logger.isPaused()) {\n    logger.resume();\n    pauseLogBtn.textContent = 'Pause';\n  } else {\n    logger.pause();\n    pauseLogBtn.textContent = 'Resume';\n  }\n});\n\nclearLogBtn.addEventListener('click', () => {\n  logger.clear();\n  renderLog();\n});\n\nsaveLogBtn.addEventListener('click', () => {\n  const content = generateLogFile();\n  downloadFile('cyd-debug-log.txt', content);\n});\n\n// ============================================================\n// Rendering\n// ============================================================\n\nfunction updateConnectionStatus(): void {\n  const bleConnected = controller.isBleConnected();\n  const serialConnected = controller.isSerialConnected();\n  \n  bleStatus.classList.toggle('connected', bleConnected);\n  bleLabel.textContent = bleConnected ? 'BLE: Connected' : 'BLE: Disconnected';\n  \n  serialStatus.classList.toggle('connected', serialConnected);\n  serialLabel.textContent = serialConnected ? 'Serial: Connected' : 'Serial: Disconnected';\n  \n  connectBleBtn.textContent = bleConnected ? 'Disconnect BLE' : 'Connect BLE MIDI';\n  connectSerialBtn.textContent = serialConnected ? 'Disconnect Serial' : 'Connect Serial';\n}\n\nlet renderScheduled = false;\n\nfunction renderLog(): void {\n  if (renderScheduled) return;\n  renderScheduled = true;\n  \n  requestAnimationFrame(() => {\n    const allEntries = logger.getEntries();\n    const searchTerm = searchBox.value.toLowerCase();\n    const showMidi = filterMidi.checked;\n    const showSerial = filterSerial.checked;\n    \n    // Filter entries\n    const entries = allEntries.filter(entry => {\n      // Filter by type\n      const isMidi = entry.source === 'BLE_IN' || entry.source === 'BLE_OUT' || entry.source === 'UI_TO_MIDI';\n      const isSerial = entry.source === 'SERIAL_IN' || entry.source === 'SERIAL_OUT';\n      \n      if (isMidi && !showMidi) return false;\n      if (isSerial && !showSerial) return false;\n      \n      // Filter by search term\n      if (searchTerm && !entry.text.toLowerCase().includes(searchTerm)) return false;\n      \n      return true;\n    });\n    \n    const autoScroll = autoScrollCheck.checked;\n    const wasAtBottom = logViewer.scrollHeight - logViewer.scrollTop <= logViewer.clientHeight + 50;\n    \n    // Render entries with left/right alignment\n    logViewer.innerHTML = entries\n      .map(entry => {\n        const isMidi = entry.source === 'BLE_IN' || entry.source === 'BLE_OUT' || entry.source === 'UI_TO_MIDI';\n        const cssClass = isMidi ? 'midi' : 'serial';\n        const formatted = formatLogEntry(entry);\n        return `<div class=\"log-entry ${cssClass}\"><div class=\"content\">${formatted}</div></div>`;\n      })\n      .join('');\n    \n    // Auto-scroll if enabled and was at bottom\n    if (autoScroll && wasAtBottom) {\n      logViewer.scrollTop = logViewer.scrollHeight;\n    }\n    \n    renderScheduled = false;\n  });\n}\n\nfunction formatLogEntry(entry: LogEntry): string {\n  let output = '';\n  \n  // Timestamp\n  output += `<span class=\"timestamp\">${formatTime(entry.tAbsMs)}</span>`;\n  \n  // Delta time (optional)\n  if (showDeltaCheck.checked && entry.tDeltaMs > 0) {\n    output += `<span class=\"timestamp\"> ${formatDelta(entry.tDeltaMs)}</span>`;\n  }\n  \n  // Source\n  const sourceLabel = formatSource(entry.source);\n  output += `<span class=\"source\">${sourceLabel}</span>`;\n  \n  // Message details\n  if (entry.midi) {\n    output += formatMidiMessage(entry.midi);\n  } else if (entry.serial) {\n    output += entry.serial.line;\n  } else {\n    output += entry.text;\n  }\n  \n  return output;\n}\n\nfunction formatSource(source: string): string {\n  switch (source) {\n    case 'UI_TO_MIDI':\n      return 'UI→MIDI';\n    case 'BLE_IN':\n      return 'CYD←BLE';\n    case 'BLE_OUT':\n      return 'CYD→BLE';\n    case 'SERIAL_IN':\n      return 'CYD→SER';\n    case 'SERIAL_OUT':\n      return 'SER→CYD';\n    default:\n      return source;\n  }\n}\n\nfunction generateLogFile(): string {\n  const allEntries = logger.getEntries();\n  \n  let output = '';\n  \n  for (const entry of allEntries) {\n    const timestamp = formatTime(entry.tAbsMs);\n    const isMidi = entry.source === 'BLE_IN' || entry.source === 'BLE_OUT' || entry.source === 'UI_TO_MIDI';\n    const prefix = isMidi ? 'MIDI' : 'TTY ';\n    \n    let message = '';\n    if (entry.midi) {\n      // formatMidiMessage returns plain text suitable for log export\n      message = formatMidiMessage(entry.midi);\n    } else if (entry.serial) {\n      message = entry.serial.line;\n    } else {\n      message = entry.text;\n    }\n    \n    output += `${timestamp} ${prefix} ${message}\\n`;\n  }\n  \n  return output;\n}\n\n// Subscribe to log updates\neventBus.subscribe(() => {\n  renderLog();\n});\n\nfunction downloadFile(filename: string, content: string): void {\n  const blob = new Blob([content], { type: 'text/plain' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  a.click();\n  URL.revokeObjectURL(url);\n}\n\n// ============================================================\n// Initialization\n// ============================================================\n\nsetupSynthVisualizer();\nupdateConnectionStatus();\nupdateSynthDisplay();\n\nconsole.log('aCYD-MIDI Web Debug Console initialized');\n"],"names":["EventBus","__publicField","callback","index","entry","fullEntry","DEFAULT_SETTINGS","midiNoteToName","note","names","octave","parseMidiMessage","data","status","messageType","channel","value14bit","formatMidiMessage","midi","b","formatTime","ms","date","hours","minutes","seconds","millis","formatDelta","BLE_MIDI_SERVICE","BLE_MIDI_CHARACTERISTIC","BleMidiConnection","eventBus","service","error","_b","_a","event","value","midiBytes","i","data1","data2","header","timestamp","bytes","SerialConnection","baudRate","textDecoder","readableStreamClosed","buffer","done","lines","line","trimmed","command","writer","encoder","Logger","config","filtered","term","updates","headers","rows","details","row","cell","output","sourceLabel","source","MidiController","name","cc","velocity","vel","testSequence","item","resolve","Synth303","now","frequency","normalizedVel","accentBoost","effectiveVel","baseCutoff","envAmount","accentEnvBoost","peakCutoff","decayTime","normalized","param","numValue","enabled","q","controller","logger","synth","$","id","connectBleBtn","connectSerialBtn","bleStatus","serialStatus","bleLabel","serialLabel","synthCanvas","cutoffDisplay","resonanceDisplay","envmodDisplay","decayDisplay","accentDisplay","volumeDisplay","searchBox","filterMidi","filterSerial","autoScrollCheck","showDeltaCheck","pauseLogBtn","clearLogBtn","saveLogBtn","logViewer","setupSynthVisualizer","ctx","width","height","draw","centerY","time","x","t","y","updateSynthDisplay","updateConnectionStatus","renderLog","content","generateLogFile","downloadFile","bleConnected","serialConnected","renderScheduled","allEntries","searchTerm","showMidi","showSerial","entries","isMidi","isSerial","autoScroll","wasAtBottom","cssClass","formatted","formatLogEntry","formatSource","prefix","message","filename","blob","url","a"],"mappings":"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"}