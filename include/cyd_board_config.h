#ifndef CYD_BOARD_CONFIG_H
#define CYD_BOARD_CONFIG_H

#include <esp_heap_caps.h>
#include <driver/spi_master.h>
#include <esp_lcd_types.h>

// Display selection
#define DISPLAY_ILI9341_SPI 1

// Basic display settings
#define DISPLAY_WIDTH 320
#define DISPLAY_HEIGHT 240
#define DISPLAY_BCKL 21
#define DISPLAY_SWAP_XY 0
#define DISPLAY_MIRROR_X 0
#define DISPLAY_MIRROR_Y 0
#define DISPLAY_GAP_X 0
#define DISPLAY_GAP_Y 0

// LVGL buffer settings
#define LVGL_BUFFER_PIXELS (DISPLAY_WIDTH * 10)
#define LVGL_BUFFER_MALLOC_FLAGS (MALLOC_CAP_INTERNAL | MALLOC_CAP_DMA)

// ILI9341 SPI bus configuration
#define ILI9341_SPI_HOST VSPI_HOST
#define ILI9341_SPI_DMA_CHANNEL SPI_DMA_CH_AUTO
#define ILI9341_SPI_BUS_MOSI 23
#define ILI9341_SPI_BUS_MISO 19
#define ILI9341_SPI_BUS_SCLK 18
#define ILI9341_SPI_BUS_QUADWP -1
#define ILI9341_SPI_BUS_QUADHD -1
#define ILI9341_SPI_BUS_MAX_TRANSFER_SZ (DISPLAY_WIDTH * 40 * 2)
#define ILI9341_SPI_BUS_FLAGS 0
#define ILI9341_SPI_BUS_INTR_FLAGS 0

#define ILI9341_SPI_CONFIG_CS 5
#define ILI9341_SPI_CONFIG_DC 27
#define ILI9341_SPI_CONFIG_SPI_MODE 0
#define ILI9341_SPI_CONFIG_PCLK_HZ (40 * 1000 * 1000)
#define ILI9341_SPI_CONFIG_TRANS_QUEUE_DEPTH 10
#define ILI9341_SPI_CONFIG_LCD_CMD_BITS 8
#define ILI9341_SPI_CONFIG_LCD_PARAM_BITS 8
#define ILI9341_SPI_CONFIG_FLAGS_DC_AS_CMD_PHASE 0
#define ILI9341_SPI_CONFIG_FLAGS_DC_LOW_ON_DATA 0
#define ILI9341_SPI_CONFIG_FLAGS_OCTAL_MODE 0
#define ILI9341_SPI_CONFIG_FLAGS_LSB_FIRST 0

#define ILI9341_DEV_CONFIG_RESET -1
#define ILI9341_DEV_CONFIG_COLOR_SPACE ESP_LCD_COLOR_SPACE_BGR
#define ILI9341_DEV_CONFIG_BITS_PER_PIXEL 16
#define ILI9341_DEV_CONFIG_FLAGS_RESET_ACTIVE_HIGH 0
#define ILI9341_DEV_CONFIG_VENDOR_CONFIG NULL

// Touch selection
#define BOARD_HAS_TOUCH 1
#define TOUCH_XPT2046_SPI 1

#define TOUCH_SWAP_XY 0
#define TOUCH_MIRROR_X 0
#define TOUCH_MIRROR_Y 0

#define CONFIG_ESP_LCD_TOUCH_MAX_POINTS 1
#define CONFIG_ESP_LCD_TOUCH_MAX_BUTTONS 0

// XPT2046 SPI bus configuration
#define XPT2046_SPI_HOST HSPI_HOST
#define XPT2046_SPI_DMA_CHANNEL SPI_DMA_CH_AUTO
#define XPT2046_SPI_BUS_MOSI 32
#define XPT2046_SPI_BUS_MISO 39
#define XPT2046_SPI_BUS_SCLK 25
#define XPT2046_SPI_BUS_QUADWP -1
#define XPT2046_SPI_BUS_QUADHD -1

#define XPT2046_SPI_CONFIG_CS 33
#define XPT2046_SPI_CONFIG_DC -1
#define XPT2046_SPI_CONFIG_SPI_MODE 0
#define XPT2046_SPI_CONFIG_PCLK_HZ (2 * 1000 * 1000)
#define XPT2046_SPI_CONFIG_TRANS_QUEUE_DEPTH 2
#define XPT2046_SPI_CONFIG_LCD_CMD_BITS 8
#define XPT2046_SPI_CONFIG_LCD_PARAM_BITS 8
#define XPT2046_SPI_CONFIG_FLAGS_DC_AS_CMD_PHASE 0
#define XPT2046_SPI_CONFIG_FLAGS_DC_LOW_ON_DATA 0
#define XPT2046_SPI_CONFIG_FLAGS_OCTAL_MODE 0
#define XPT2046_SPI_CONFIG_FLAGS_LSB_FIRST 0

#define XPT2046_TOUCH_CONFIG_X_MAX DISPLAY_WIDTH
#define XPT2046_TOUCH_CONFIG_Y_MAX DISPLAY_HEIGHT
#define XPT2046_TOUCH_CONFIG_RST -1
#define XPT2046_TOUCH_CONFIG_INT 36
#define XPT2046_TOUCH_CONFIG_LEVELS_RESET 0
#define XPT2046_TOUCH_CONFIG_LEVELS_INTERRUPT 0
#define XPT2046_Z_THRESHOLD 400

#endif
